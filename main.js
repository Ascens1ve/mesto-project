!function(){"use strict";var e=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(o.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(o.inactiveButtonClass),t.setAttribute("disabled",""))},t=function(e,t,o){console.log(t.validity),t.validity.valid?function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));n.textContent="",n.classList.remove(o.errorClass),t.classList.remove(o.inputErrorClass)}(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)},o={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"97139ce0-7eca-4035-8302-c2f2b2ac84ab","Content-Type":"application/json"}};function n(e,t,o,n,r){var c=e.cloneNode(!0);return c.querySelector(".card__title").textContent=t,c.querySelector(".card__image").src=o,c.id=n,r&&(c.querySelector(".card__delete-button").style.display="none"),c}function r(e){"Escape"===e.key&&i(document.querySelector(".popup_is-opened"))}function c(e){e.target.classList.contains("popup")&&i(e.target)}function a(e,t){e.classList.add("popup_is-opened"),"function"==typeof t&&t(e),document.addEventListener("keydown",r),document.addEventListener("click",c)}function i(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r),document.removeEventListener("click",c)}var u={profilePopup:document.querySelector(".popup_type_edit"),cardPopup:document.querySelector(".popup_type_new-card"),imagePopup:document.querySelector(".popup_type_image"),avatarPopup:document.querySelector(".popup_type_new-avatar")};Object.values(u).forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){i(e)}))}));var s={title:document.querySelector(".profile__title"),description:document.querySelector(".profile__description"),avatar:document.querySelector(".profile__image"),id:""};s.avatar.addEventListener("click",(function(){a(u.avatarPopup,l)})),u.avatarPopup.querySelector(".popup__form").addEventListener("submit",(function(e){var t;e.preventDefault(),u.avatarPopup.querySelector(".popup__button").textContent="Сохранение...",(t=e.currentTarget.querySelector(".popup__input").value,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){s.avatar.style.backgroundImage="url('".concat(e.avatar,"')"),i(u.avatarPopup)})).catch((function(e){console.log(e)})).finally((function(){u.avatarPopup.querySelector(".popup__button").textContent="Сохранить"}))})),fetch("".concat(o.baseUrl,"/users/me"),{method:"GET",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){s.title.textContent=e.name,s.description.textContent=e.about,s.avatar.style.backgroundImage="url('".concat(e.avatar,"')"),s.id=e._id})).catch((function(e){console.log(e)}));var l=function(o){var n=Array.from(o.querySelectorAll(P.inputSelector)),r=o.querySelector(P.submitButtonSelector);n.forEach((function(e){t(o,e,P)})),e(n,r,P)},p=document.querySelector(".profile__edit-button"),d=document.querySelector(".profile__add-button"),_=u.profilePopup.querySelector(".popup__form"),f=_.querySelector(".popup__input_type_name"),m=_.querySelector(".popup__input_type_description");p.addEventListener("click",(function(){f.value=s.title.textContent,m.value=s.description.textContent,a(u.profilePopup,l)})),_.addEventListener("submit",(function(e){var t,n;e.preventDefault(),u.profilePopup.querySelector(".popup__button").textContent="Сохранение...",(t=f.value,n=m.value,fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){s.title.textContent=e.name,s.description.textContent=e.about,i(u.profilePopup)})).catch((function(e){console.log(e)})).finally((function(){u.profilePopup.querySelector(".popup__button").textContent="Сохранить"}))}));var v=u.cardPopup.querySelector(".popup__form"),y=v.querySelector(".popup__input_type_card-name"),h=v.querySelector(".popup__input_type_url"),S=document.querySelector("#card-template").content.querySelector(".places__item"),b=document.querySelector(".places__list");d.addEventListener("click",(function(){y.value="",h.value="",a(u.cardPopup,l)})),v.addEventListener("submit",(function(e){var t,r;e.preventDefault(),u.cardPopup.querySelector(".popup__button").textContent="Создание...",(t=y.value,r=h.value,fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:t,link:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){b.prepend(n(S,e.name,e.link,e._id)),i(u.cardPopup)})).catch((function(e){console.log(e)})).finally((function(){u.cardPopup.querySelector(".popup__button").textContent="Создать"}))}));var g=document.querySelector(".places__list"),q=u.imagePopup.querySelector(".popup__image"),k=u.imagePopup.querySelector(".popup__caption");g.addEventListener("click",(function(e){var t;e.target.classList.contains("card__like-button")?e.target.classList.contains("card__like-button_is-active")?(t=e.target.closest(".places__item").id,fetch("".concat(o.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:o.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(t){e.target.parentElement.querySelector(".card__likes-count").textContent=t.likes.length,e.target.classList.remove("card__like-button_is-active")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:o.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e.target.closest(".places__item").id).then((function(t){e.target.parentElement.querySelector(".card__likes-count").textContent=t.likes.length,e.target.classList.add("card__like-button_is-active")})).catch((function(e){console.log(e)})):e.target.classList.contains("card__delete-button")&&(console.log(e.target.closest(".places__item").id),function(e){return fetch("".concat(o.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:{authorization:o.headers.authorization}}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))}))}(e.target.closest(".places__item").id).then((function(){e.target.closest(".places__item").remove()})).catch((function(e){console.log(e)})))})),g.addEventListener("click",(function(e){e.target.classList.contains("card__image")&&(k.textContent=e.target.parentElement.querySelector(".card__description .card__title").textContent,q.src=e.target.src,a(u.imagePopup))})),fetch("".concat(o.baseUrl,"/cards"),{method:"GET",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=e.owner._id===s.id?n(S,e.name,e.link,e._id,!1):n(S,e.name,e.link,e._id,!0);e.likes.some((function(e){return e._id===s.id}))&&t.querySelector(".card__like-button").classList.add("card__like-button_is-active"),t.querySelector(".card__likes-count").textContent=e.likes.length,b.append(t)}))})).catch((function(e){console.log(e)}));var E,P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};E=P,Array.from(document.querySelectorAll(E.formSelector)).forEach((function(o){!function(o,n){var r=Array.from(o.querySelectorAll(n.inputSelector)),c=o.querySelector(n.submitButtonSelector);e(r,c,n),r.forEach((function(a){a.addEventListener("input",(function(){t(o,a,n),e(r,c,n)}))}))}(o,E)}))}();