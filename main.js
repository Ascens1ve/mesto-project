!function(){"use strict";var t=function(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(o.inactiveButtonClass),e.removeAttribute("disabled")):(e.classList.add(o.inactiveButtonClass),e.setAttribute("disabled",""))},e=function(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));n.textContent="",n.classList.remove(o.errorClass),e.classList.remove(o.inputErrorClass)},o={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"97139ce0-7eca-4035-8302-c2f2b2ac84ab","Content-Type":"application/json"}},n=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))};function r(t,e,o,n,r){var a=t.cloneNode(!0);return a.querySelector(".card__title").textContent=e,a.querySelector(".card__image").src=o,a.id=n,r&&(a.querySelector(".card__delete-button").style.display="none"),a}var a={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},c=function(e){var o=Array.from(e.querySelectorAll(a.inputSelector)),n=e.querySelector(a.submitButtonSelector);t(o,n,a)},i=function(t){Array.from(t.querySelectorAll(a.inputSelector)).forEach((function(o){o.validity.valid||e(t,o,a)})),t.addEventListener("transitionend",(function e(){t.querySelector(".popup__form").dataset.isSubmitting="false",c(t),t.removeEventListener("transitionend",e)}))};function u(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e.classList.contains("popup_type_image")?l(e):l(e,i)}}function s(t){t.target.classList.contains("popup")&&(t.target.classList.contains("popup_type_image")?l(t.target):l(t.target,i))}function p(t,e){t.classList.add("popup_is-opened"),"function"==typeof e&&e(t),document.addEventListener("keydown",u),document.addEventListener("click",s)}function l(t,e){t.classList.remove("popup_is-opened"),"function"==typeof e&&e(t),document.removeEventListener("keydown",u),document.removeEventListener("click",s)}var d={profilePopup:document.querySelector(".popup_type_edit"),cardPopup:document.querySelector(".popup_type_new-card"),imagePopup:document.querySelector(".popup_type_image"),avatarPopup:document.querySelector(".popup_type_new-avatar")};Object.values(d).forEach((function(t){t.querySelector(".popup__close").addEventListener("click",(function(){t.classList.contains("popup_type_image")?l(t):l(t,i)}))}));var _={title:document.querySelector(".profile__title"),description:document.querySelector(".profile__description"),avatar:document.querySelector(".profile__image"),id:""};_.avatar.addEventListener("click",(function(){d.avatarPopup.querySelector(".popup__input").value="",p(d.avatarPopup,c)}));var f=function(t){return Array.from(t.querySelectorAll(".popup__input"))};d.avatarPopup.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();var r,c=d.avatarPopup.querySelector(".popup__button");c.textContent="Сохранение...",(r=e.currentTarget.querySelector(".popup__input").value,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:r})}).then(n)).then((function(t){_.avatar.style.backgroundImage="url('".concat(t.avatar,"')"),l(d.avatarPopup,i)})).catch((function(e){console.log(e),d.avatarPopup.querySelector(".popup__form").dataset.isSubmitting="false",t(f(d.avatarPopup),c,a)})).finally((function(){c.textContent="Сохранить"}))})),fetch("".concat(o.baseUrl,"/users/me"),{method:"GET",headers:o.headers}).then(n).then((function(t){_.title.textContent=t.name,_.description.textContent=t.about,_.avatar.style.backgroundImage="url('".concat(t.avatar,"')"),_.id=t._id})).catch((function(t){console.log(t)}));var m=document.querySelector(".profile__edit-button"),v=document.querySelector(".profile__add-button"),y=d.profilePopup.querySelector(".popup__form"),h=y.querySelector(".popup__input_type_name"),S=y.querySelector(".popup__input_type_description");m.addEventListener("click",(function(){h.value=_.title.textContent,S.value=_.description.textContent,p(d.profilePopup,c)})),y.addEventListener("submit",(function(e){e.preventDefault();var r,c,u=d.profilePopup.querySelector(".popup__button");u.textContent="Сохранение...",(r=h.value,c=S.value,fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:r,about:c})}).then(n)).then((function(t){_.title.textContent=t.name,_.description.textContent=t.about,l(d.profilePopup,i)})).catch((function(e){console.log(e),d.profilePopup.querySelector(".popup__form").dataset.isSubmitting="false",t(f(d.profilePopup),u,a)})).finally((function(){u.textContent="Сохранить"}))}));var g=d.cardPopup.querySelector(".popup__form"),b=g.querySelector(".popup__input_type_card-name"),q=g.querySelector(".popup__input_type_url"),L=document.querySelector("#card-template").content.querySelector(".places__item"),E=document.querySelector(".places__list");v.addEventListener("click",(function(){b.value="",q.value="",p(d.cardPopup,c)})),g.addEventListener("submit",(function(e){e.preventDefault();var c,u,s=d.cardPopup.querySelector(".popup__button");s.textContent="Создание...",(c=b.value,u=q.value,fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:c,link:u})}).then(n)).then((function(t){E.prepend(r(L,t.name,t.link,t._id)),l(d.cardPopup,i)})).catch((function(e){console.log(e),d.cardPopup.querySelector(".popup__form").dataset.isSubmitting="false",t(f(d.cardPopup),s,a)})).finally((function(){s.textContent="Создать"}))}));var k,C=document.querySelector(".places__list"),P=d.imagePopup.querySelector(".popup__image"),x=d.imagePopup.querySelector(".popup__caption");C.addEventListener("click",(function(t){var e;t.target.classList.contains("card__like-button")?t.target.classList.contains("card__like-button_is-active")?(e=t.target.closest(".places__item").id,fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:o.headers.authorization}}).then(n)).then((function(e){t.target.parentElement.querySelector(".card__likes-count").textContent=e.likes.length,t.target.classList.remove("card__like-button_is-active")})).catch((function(t){console.log(t)})):function(t){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:o.headers.authorization}}).then(n)}(t.target.closest(".places__item").id).then((function(e){t.target.parentElement.querySelector(".card__likes-count").textContent=e.likes.length,t.target.classList.add("card__like-button_is-active")})).catch((function(t){console.log(t)})):t.target.classList.contains("card__delete-button")&&function(t){return fetch("".concat(o.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:{authorization:o.headers.authorization}}).then((function(t){if(!t.ok)return Promise.reject("Ошибка: ".concat(t.status))}))}(t.target.closest(".places__item").id).then((function(){t.target.closest(".places__item").remove()})).catch((function(t){console.log(t)}))})),C.addEventListener("click",(function(t){t.target.classList.contains("card__image")&&(x.textContent=t.target.parentElement.querySelector(".card__description .card__title").textContent,P.src=t.target.src,p(d.imagePopup))})),fetch("".concat(o.baseUrl,"/cards"),{method:"GET",headers:o.headers}).then(n).then((function(t){t.forEach((function(t){var e=t.owner._id===_.id?r(L,t.name,t.link,t._id,!1):r(L,t.name,t.link,t._id,!0);t.likes.some((function(t){return t._id===_.id}))&&e.querySelector(".card__like-button").classList.add("card__like-button_is-active"),e.querySelector(".card__likes-count").textContent=t.likes.length,E.append(e)}))})).catch((function(t){console.log(t)})),k=a,Array.from(document.querySelectorAll(k.formSelector)).forEach((function(o){!function(o,n){var r=Array.from(o.querySelectorAll(n.inputSelector)),a=o.querySelector(n.submitButtonSelector);t(r,a,n),r.forEach((function(c){c.addEventListener("input",(function(){"true"!==o.dataset.isSubmitting&&(function(t,o,n){o.validity.valid?e(t,o,n):function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(t,o,o.validationMessage,n)}(o,c,n),t(r,a,n))}))})),o.addEventListener("submit",(function(){o.dataset.isSubmitting="true",a.classList.add(n.inactiveButtonClass),a.setAttribute("disabled","")}))}(o,k)}))}();