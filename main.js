!function(){"use strict";var e=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(o.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(o.inactiveButtonClass),t.setAttribute("disabled",""))},t=function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));n.textContent="",n.classList.remove(o.errorClass),t.classList.remove(o.inputErrorClass)},o={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"97139ce0-7eca-4035-8302-c2f2b2ac84ab","Content-Type":"application/json"}},n=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function r(e,t,o,n,r){var a=e.cloneNode(!0);return a.querySelector(".card__title").textContent=t,a.querySelector(".card__image").src=o,a.id=n,r&&(a.querySelector(".card__delete-button").style.display="none"),a}var a={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},c=function(t){var o=Array.from(t.querySelectorAll(a.inputSelector)),n=t.querySelector(a.submitButtonSelector);e(o,n,a)},i=function(e){Array.from(e.querySelectorAll(a.inputSelector)).forEach((function(o){o.validity.valid||t(e,o,a)}))};function u(e){"Escape"===e.key&&p(document.querySelector(".popup_is-opened"),i)}function l(e){e.target.classList.contains("popup")&&p(e.target,i)}function s(e,t){e.classList.add("popup_is-opened"),"function"==typeof t&&t(e),document.addEventListener("keydown",u),document.addEventListener("click",l)}function p(e,t){e.classList.remove("popup_is-opened"),"function"==typeof t&&t(e),document.removeEventListener("keydown",u),document.removeEventListener("click",l)}var d={profilePopup:document.querySelector(".popup_type_edit"),cardPopup:document.querySelector(".popup_type_new-card"),imagePopup:document.querySelector(".popup_type_image"),avatarPopup:document.querySelector(".popup_type_new-avatar")};Object.values(d).forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){p(e,i)}))}));var _={title:document.querySelector(".profile__title"),description:document.querySelector(".profile__description"),avatar:document.querySelector(".profile__image"),id:""};_.avatar.addEventListener("click",(function(){d.avatarPopup.querySelector(".popup__input").value="",s(d.avatarPopup,c)})),d.avatarPopup.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();var t,r=d.avatarPopup.querySelector(".popup__button");r.textContent="Сохранение...",r.setAttribute("disabled",""),(t=e.currentTarget.querySelector(".popup__input").value,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:t})}).then(n)).then((function(e){_.avatar.style.backgroundImage="url('".concat(e.avatar,"')"),p(d.avatarPopup,i)})).catch((function(e){console.log(e)})).finally((function(){r.removeAttribute("disabled"),r.textContent="Сохранить"}))})),fetch("".concat(o.baseUrl,"/users/me"),{method:"GET",headers:o.headers}).then(n).then((function(e){_.title.textContent=e.name,_.description.textContent=e.about,_.avatar.style.backgroundImage="url('".concat(e.avatar,"')"),_.id=e._id})).catch((function(e){console.log(e)}));var f=document.querySelector(".profile__edit-button"),m=document.querySelector(".profile__add-button"),v=d.profilePopup.querySelector(".popup__form"),y=v.querySelector(".popup__input_type_name"),h=v.querySelector(".popup__input_type_description");f.addEventListener("click",(function(){y.value=_.title.textContent,h.value=_.description.textContent,s(d.profilePopup,c)})),v.addEventListener("submit",(function(e){e.preventDefault();var t,r,a=d.profilePopup.querySelector(".popup__button");a.textContent="Сохранение...",a.setAttribute("disabled",""),(t=y.value,r=h.value,fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:t,about:r})}).then(n)).then((function(e){_.title.textContent=e.name,_.description.textContent=e.about,p(d.profilePopup,i)})).catch((function(e){console.log(e)})).finally((function(){a.removeAttribute("disabled"),a.textContent="Сохранить"}))}));var S=d.cardPopup.querySelector(".popup__form"),b=S.querySelector(".popup__input_type_card-name"),g=S.querySelector(".popup__input_type_url"),q=document.querySelector("#card-template").content.querySelector(".places__item"),k=document.querySelector(".places__list");m.addEventListener("click",(function(){b.value="",g.value="",s(d.cardPopup,c)})),S.addEventListener("submit",(function(e){e.preventDefault();var t,a,c=d.cardPopup.querySelector(".popup__button");c.setAttribute("disabled",""),c.textContent="Создание...",(t=b.value,a=g.value,fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:t,link:a})}).then(n)).then((function(e){k.prepend(r(q,e.name,e.link,e._id)),p(d.cardPopup,i)})).catch((function(e){console.log(e)})).finally((function(){c.removeAttribute("disabled"),c.textContent="Создать"}))}));var E,C=document.querySelector(".places__list"),L=d.imagePopup.querySelector(".popup__image"),P=d.imagePopup.querySelector(".popup__caption");C.addEventListener("click",(function(e){var t;e.target.classList.contains("card__like-button")?e.target.classList.contains("card__like-button_is-active")?(t=e.target.closest(".places__item").id,fetch("".concat(o.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:o.headers.authorization}}).then(n)).then((function(t){e.target.parentElement.querySelector(".card__likes-count").textContent=t.likes.length,e.target.classList.remove("card__like-button_is-active")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:o.headers.authorization}}).then(n)}(e.target.closest(".places__item").id).then((function(t){e.target.parentElement.querySelector(".card__likes-count").textContent=t.likes.length,e.target.classList.add("card__like-button_is-active")})).catch((function(e){console.log(e)})):e.target.classList.contains("card__delete-button")&&(console.log(e.target.closest(".places__item").id),function(e){return fetch("".concat(o.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:{authorization:o.headers.authorization}}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))}))}(e.target.closest(".places__item").id).then((function(){e.target.closest(".places__item").remove()})).catch((function(e){console.log(e)})))})),C.addEventListener("click",(function(e){e.target.classList.contains("card__image")&&(P.textContent=e.target.parentElement.querySelector(".card__description .card__title").textContent,L.src=e.target.src,s(d.imagePopup))})),fetch("".concat(o.baseUrl,"/cards"),{method:"GET",headers:o.headers}).then(n).then((function(e){e.forEach((function(e){var t=e.owner._id===_.id?r(q,e.name,e.link,e._id,!1):r(q,e.name,e.link,e._id,!0);e.likes.some((function(e){return e._id===_.id}))&&t.querySelector(".card__like-button").classList.add("card__like-button_is-active"),t.querySelector(".card__likes-count").textContent=e.likes.length,k.append(t)}))})).catch((function(e){console.log(e)})),E=a,Array.from(document.querySelectorAll(E.formSelector)).forEach((function(o){!function(o,n){var r=Array.from(o.querySelectorAll(n.inputSelector)),a=o.querySelector(n.submitButtonSelector);e(r,a,n),r.forEach((function(c){c.addEventListener("input",(function(){!function(e,o,n){o.validity.valid?t(e,o,n):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,o,o.validationMessage,n)}(o,c,n),e(r,a,n)}))}))}(o,E)}))}();