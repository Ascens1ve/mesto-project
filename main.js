!function(){"use strict";var t=function(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(o.inactiveButtonClass),e.removeAttribute("disabled")):(e.classList.add(o.inactiveButtonClass),e.setAttribute("disabled",""))},e=function(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));n.textContent="",n.classList.remove(o.errorClass),e.classList.remove(o.inputErrorClass)},o={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"97139ce0-7eca-4035-8302-c2f2b2ac84ab","Content-Type":"application/json"}},n=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))};function r(t,e,o,n,r){var a=t.cloneNode(!0);return a.querySelector(".card__title").textContent=e,a.querySelector(".card__image").src=o,a.id=n,r&&(a.querySelector(".card__delete-button").style.display="none"),a}var a={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active",submittingButtonClass:"popup__button_sumbit"},c=function(e){var o=e.querySelector(a.submitButtonSelector);if(!o.classList.contains(a.submittingButtonClass)){var n=Array.from(e.querySelectorAll(a.inputSelector));t(n,o,a)}},i=function(t){Array.from(t.querySelectorAll(a.inputSelector)).forEach((function(o){o.validity.valid||e(t,o,a)}))};function u(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");if(e.classList.contains("popup_type_image"))p(e);else{if(e.querySelector(".popup__button").classList.contains(a.submittingButtonClass))return;p(e,i)}}}function s(t){if(t.target.classList.contains("popup"))if(t.target.classList.contains("popup_type_image"))p(t.target);else{if(t.target.querySelector(".popup__button").classList.contains(a.submittingButtonClass))return;p(t.target,i)}}function l(t,e){t.classList.add("popup_is-opened"),"function"==typeof e&&e(t),document.addEventListener("keydown",u),document.addEventListener("click",s)}function p(t,e){t.classList.remove("popup_is-opened"),"function"==typeof e&&e(t),document.removeEventListener("keydown",u),document.removeEventListener("click",s)}var d={profilePopup:document.querySelector(".popup_type_edit"),cardPopup:document.querySelector(".popup_type_new-card"),imagePopup:document.querySelector(".popup_type_image"),avatarPopup:document.querySelector(".popup_type_new-avatar")};Object.values(d).forEach((function(t){t.querySelector(".popup__close").addEventListener("click",(function(){t.classList.contains("popup_type_image")?p(t):t.querySelector(".popup__button").classList.contains(a.submittingButtonClass)||p(t,i)}))}));var _={title:document.querySelector(".profile__title"),description:document.querySelector(".profile__description"),avatar:document.querySelector(".profile__image"),id:""};_.avatar.addEventListener("click",(function(){d.avatarPopup.querySelector(".popup__input").value="",l(d.avatarPopup,c)}));var f=function(t){return Array.from(t.querySelectorAll(".popup__input"))},m=function(t,e,o){t.forEach((function(t){t.disabled=!t.disabled})),e.disabled=!e.disabled,e.classList.toggle(o.inactiveButtonClass),e.classList.toggle(o.submittingButtonClass)};d.avatarPopup.querySelector(".popup__form").addEventListener("submit",(function(t){t.preventDefault();var e,r=d.avatarPopup.querySelector(".popup__button"),c=f(d.avatarPopup);m(c,r,a),r.textContent="Сохранение...",(e=t.currentTarget.querySelector(".popup__input").value,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:e})}).then(n)).then((function(t){_.avatar.style.backgroundImage="url('".concat(t.avatar,"')"),p(d.avatarPopup,i)})).catch((function(t){console.log(t)})).finally((function(){r.textContent="Сохранить",m(c,r,a)}))})),fetch("".concat(o.baseUrl,"/users/me"),{method:"GET",headers:o.headers}).then(n).then((function(t){_.title.textContent=t.name,_.description.textContent=t.about,_.avatar.style.backgroundImage="url('".concat(t.avatar,"')"),_.id=t._id})).catch((function(t){console.log(t)}));var v=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__add-button"),h=d.profilePopup.querySelector(".popup__form"),S=h.querySelector(".popup__input_type_name"),g=h.querySelector(".popup__input_type_description");v.addEventListener("click",(function(){S.value=_.title.textContent,g.value=_.description.textContent,l(d.profilePopup,c)})),h.addEventListener("submit",(function(t){t.preventDefault();var e,r,c=d.profilePopup.querySelector(".popup__button"),u=f(d.profilePopup);m(u,c,a),c.textContent="Сохранение...",(e=S.value,r=g.value,fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:e,about:r})}).then(n)).then((function(t){_.title.textContent=t.name,_.description.textContent=t.about,p(d.profilePopup,i)})).catch((function(t){console.log(t)})).finally((function(){c.textContent="Сохранить",m(u,c,a)}))}));var b=d.cardPopup.querySelector(".popup__form"),q=b.querySelector(".popup__input_type_card-name"),L=b.querySelector(".popup__input_type_url"),C=document.querySelector("#card-template").content.querySelector(".places__item"),E=document.querySelector(".places__list");y.addEventListener("click",(function(){q.value="",L.value="",l(d.cardPopup,c)})),b.addEventListener("submit",(function(t){t.preventDefault();var e,c,u=d.cardPopup.querySelector(".popup__button"),s=f(d.cardPopup);m(s,u,a),u.textContent="Создание...",(e=q.value,c=L.value,fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:e,link:c})}).then(n)).then((function(t){E.prepend(r(C,t.name,t.link,t._id)),p(d.cardPopup,i)})).catch((function(t){console.log(t)})).finally((function(){u.textContent="Создать",m(s,u,a)}))}));var k,P=document.querySelector(".places__list"),x=d.imagePopup.querySelector(".popup__image"),A=d.imagePopup.querySelector(".popup__caption");P.addEventListener("click",(function(t){var e;t.target.classList.contains("card__like-button")?t.target.classList.contains("card__like-button_is-active")?(e=t.target.closest(".places__item").id,fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:o.headers.authorization}}).then(n)).then((function(e){t.target.parentElement.querySelector(".card__likes-count").textContent=e.likes.length,t.target.classList.remove("card__like-button_is-active")})).catch((function(t){console.log(t)})):function(t){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:o.headers.authorization}}).then(n)}(t.target.closest(".places__item").id).then((function(e){t.target.parentElement.querySelector(".card__likes-count").textContent=e.likes.length,t.target.classList.add("card__like-button_is-active")})).catch((function(t){console.log(t)})):t.target.classList.contains("card__delete-button")&&function(t){return fetch("".concat(o.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:{authorization:o.headers.authorization}}).then((function(t){if(!t.ok)return Promise.reject("Ошибка: ".concat(t.status))}))}(t.target.closest(".places__item").id).then((function(){t.target.closest(".places__item").remove()})).catch((function(t){console.log(t)}))})),P.addEventListener("click",(function(t){t.target.classList.contains("card__image")&&(A.textContent=t.target.parentElement.querySelector(".card__description .card__title").textContent,x.src=t.target.src,l(d.imagePopup))})),fetch("".concat(o.baseUrl,"/cards"),{method:"GET",headers:o.headers}).then(n).then((function(t){t.forEach((function(t){var e=t.owner._id===_.id?r(C,t.name,t.link,t._id,!1):r(C,t.name,t.link,t._id,!0);t.likes.some((function(t){return t._id===_.id}))&&e.querySelector(".card__like-button").classList.add("card__like-button_is-active"),e.querySelector(".card__likes-count").textContent=t.likes.length,E.append(e)}))})).catch((function(t){console.log(t)})),k=a,Array.from(document.querySelectorAll(k.formSelector)).forEach((function(o){!function(o,n){var r=Array.from(o.querySelectorAll(n.inputSelector)),a=o.querySelector(n.submitButtonSelector);t(r,a,n),r.forEach((function(c){c.addEventListener("input",(function(){!function(t,o,n){o.validity.valid?e(t,o,n):function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(t,o,o.validationMessage,n)}(o,c,n),t(r,a,n)}))}))}(o,k)}))}();